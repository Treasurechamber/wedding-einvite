<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sarah & Michael – Wedding Invitation</title>

  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- jQuery & Slick Carousel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <!-- Canvas Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

  <style>
    /* === ROOT VARIABLES & RESET === */
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@100;200;300;400;500;600;700&display=swap');
    :root {
      --primary: #d4b08c;
      --secondary: #f8f5f2;
      --accent: #2c3e50;
      --text: #333;
      --light: #f8f5f2;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Montserrat',sans-serif; color:var(--text); background:var(--secondary); overflow-x:hidden; }

    /* === HERO === */
    .hero {
      height:100vh;
      background:
        linear-gradient(rgba(0,0,0,.3),rgba(0,0,0,.3)),
        url('/api/placeholder/1200/800') center/cover no-repeat;
      display:flex; align-items:center; justify-content:center;
      text-align:center; color:var(--light); position:relative;
      background-attachment:fixed;
    }
    .hero h1 { font-family:'Cormorant Garamond',serif; font-size:3.5rem; letter-spacing:3px; margin-bottom:1rem; }
    .hero h2 { font-family:'Cormorant Garamond',serif; font-weight:300; font-size:1.8rem; margin-bottom:2rem; }
    .hero .date { font-size:1.2rem; letter-spacing:2px; margin-bottom:2rem; }
    .btn {
      display:inline-block; padding:12px 32px; background:var(--primary); color:#fff;
      border:none; border-radius:50px; text-transform:uppercase; letter-spacing:1px;
      position:relative; overflow:hidden; z-index:1; cursor:pointer; transition:all .3s;
    }
    .btn::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:rgba(255,255,255,.2); transition:all .3s; z-index:-1;
    }
    .btn:hover::before { left:0; }
    .btn:hover { transform:translateY(-3px); box-shadow:0 10px 20px rgba(0,0,0,.2); }

    /* === NAV === */
    nav { position:fixed; top:0; left:0; width:100%; padding:20px 0; z-index:100; transition:all .3s; }
    nav.scrolled { background:rgba(255,255,255,.95); box-shadow:0 2px 10px rgba(0,0,0,.1); padding:10px 0; }
    .nav-container { max-width:1200px; margin:0 auto; padding:0 15px; display:flex; align-items:center; justify-content:space-between; }
    .logo { font-family:'Cormorant Garamond',serif; font-size:1.8rem; color:#fff; text-decoration:none; }
    nav.scrolled .logo { color:var(--text); }
    .nav-links { list-style:none; display:flex; }
    .nav-links li { margin-left:30px; }
    .nav-links a {
      text-decoration:none; color:#fff; font-weight:500; font-size:.9rem;
      text-transform:uppercase; letter-spacing:1px; transition:color .3s;
    }
    .nav-links a:hover { color:var(--primary); }
    nav.scrolled .nav-links a { color:var(--text); }
    .mobile-nav-toggle { display:none; background:transparent; border:none; font-size:1.5rem; color:#fff; cursor:pointer; }
    @media(max-width:768px) {
      .mobile-nav-toggle { display:block; z-index:102; }
      .nav-links {
        position:fixed; top:0; right:-100%; width:70%; height:100vh;
        background:#fff; flex-direction:column; align-items:center; justify-content:center;
        transition:right .5s; z-index:101;
      }
      .nav-links.active { right:0; }
      .nav-links li { margin:20px 0; }
      .nav-links a { color:var(--text); font-size:1.2rem; }
    }

    /* === SECTIONS === */
    section { padding:100px 0; }
    .countdown-section { background:#fff; text-align:center; }
    .countdown { display:flex; justify-content:center; gap:30px; flex-wrap:wrap; }
    .countdown-item { text-align:center; cursor:pointer; transition:transform .3s; }
    .countdown-item:hover { transform:scale(1.1); }
    .countdown-num {
      font-size:3rem; font-weight:600; color:var(--primary);
      background:var(--secondary); width:120px; height:120px;
      display:flex; align-items:center; justify-content:center;
      border-radius:10px; box-shadow:0 10px 20px rgba(0,0,0,.05);
      position:relative; overflow:hidden;
    }
    .countdown-num::before {
      content:''; position:absolute; top:-100%; left:0;
      width:100%; height:100%; background:linear-gradient(to bottom,rgba(255,255,255,.5),transparent);
      animation:shine 5s infinite;
    }
    @keyframes shine { 0%{top:-100%}20%{top:100%}100%{top:100%} }
    .countdown-label { text-transform:uppercase; letter-spacing:2px; font-size:.9rem; color:var(--accent); }

    /* === TIMELINE === */
    .story-section { background:var(--secondary); }
    .timeline { position:relative; max-width:800px; margin:0 auto; }
    .timeline::after {
      content:''; position:absolute; top:0; bottom:0; left:50%; width:2px;
      background:var(--primary); transform:translateX(-50%);
    }
    .timeline-item {
      width:50%; padding:20px 40px; position:relative; animation:fadeIn 1s ease-in-out;
    }
    .timeline-item:nth-child(even) { left:50%; }
    .timeline-item:nth-child(odd)  { left:0; }
    .timeline-content {
      background:#fff; padding:20px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.1);
      cursor:pointer; transition:transform .3s, box-shadow .3s;
      perspective:1000px;
    }
    .timeline-content:hover {
      transform:translateY(-5px) rotateY(15deg);
      box-shadow:0 10px 20px rgba(0,0,0,.1);
    }
    .timeline-date {
      display:inline-block; background:var(--primary); color:#fff;
      padding:5px 15px; border-radius:20px; font-weight:600; margin-bottom:15px;
      position:relative;
    }
    .timeline-date::after {
      content:'→'; margin-left:10px; animation:bounce 1s infinite;
    }
    @keyframes bounce {0%,100%{transform:translateX(0)}50%{transform:translateX(3px)}}

    /* === TIMELINE MODAL === */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:1000; }
    .modal-content { background:#fff; margin:5% auto; padding:30px; border-radius:10px; max-width:800px; animation:slideIn .5s ease; }
    .close-modal { position:absolute; top:15px; right:15px; font-size:1.5rem; color:var(--text); cursor:pointer; }
    .timeline-story-slider .timeline-slide { text-align:center; }
    .timeline-slide img { width:100%; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.1); margin-bottom:15px; }
    .timeline-caption { font-style:italic; color:var(--text); }

    /* === GALLERY === */
    .gallery-section { background:#fff; text-align:center; }
    .gallery-slider .gallery-item { padding:10px; height:400px; }
    .gallery-item img { width:100%; height:100%; object-fit:cover; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.1); }

    /* === DETAILS === */
    .details-section { background:var(--secondary); }
    .details-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:30px; }
    .detail-card {
      background:#fff; padding:30px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,.1);
      text-align:center; perspective:1000px; transition:transform .6s;
    }
    .detail-card:hover { transform:translateY(-10px) rotateY(5deg); }
    .detail-card i { font-size:2.5rem; color:var(--primary); margin-bottom:20px; }
    .detail-card h3 { font-family:'Cormorant Garamond',serif; color:var(--accent); margin-bottom:15px; }

    /* === RSVP === */
    .rsvp-section {
      background:linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),url('/api/placeholder/1200/600') center/cover no-repeat;
      color:var(--light); text-align:center;
    }
    .rsvp-form { background:#fff; padding:40px; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.2); max-width:600px; margin:0 auto; text-align:left; }
    .form-group { margin-bottom:20px; }
    .form-group label { display:block; margin-bottom:8px; font-weight:500; }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width:100%; padding:12px; border:1px solid #ddd; border-radius:5px; font-family:'Montserrat',sans-serif;
    }
    .radio-group { display:flex; gap:20px; }
    .radio-option input { margin-right:8px; }

    /* === ADMIN DASHBOARD === */
    .admin-dashboard { background:var(--secondary); padding:100px 0; }
    .stats-grid { display:flex; gap:30px; justify-content:center; flex-wrap:wrap; margin-bottom:30px; }
    .stat-gauge { width:150px; text-align:center; }
    .stat-gauge svg { width:100px; height:100px; transform:rotate(-90deg); }
    .gauge-bg { fill:none; stroke:#eee; stroke-width:10; }
    .gauge-fill {
      fill:none; stroke-width:10; stroke-linecap:round;
      stroke-dasharray:283; stroke-dashoffset:283;
      transition:stroke-dashoffset 1.2s ease-out;
    }
    #gauge-attending { stroke:#4CAF50; }
    #gauge-not-attending { stroke:#F44336; }
    .stat-gauge text {
      font-size:14px; fill:var(--text); transform:rotate(90deg);
    }
    .filters {
      display:flex; justify-content:space-between; background:var(--secondary);
      padding:15px; border-radius:8px; margin-bottom:20px; flex-wrap:wrap; gap:15px;
    }
    .filter-group { display:flex; align-items:center; gap:10px; }
    .filter-group input, .filter-group select { padding:8px 12px; border:1px solid #ddd; border-radius:5px; }
    .guest-list-table { width:100%; border-collapse:collapse; }
    .guest-list-table th, .guest-list-table td { padding:12px; text-align:left; border-bottom:1px solid #eee; }
    .status-attending { color:#4CAF50; font-weight:500; }
    .status-not-attending { color:#F44336; font-weight:500; }

    /* === FOOTER === */
    .footer { background:var(--accent); padding:50px 0; text-align:center; color:var(--light); }
    .footer h2 { margin-bottom:20px; font-size:2rem; }
    .social-links { display:flex; justify-content:center; gap:20px; margin-bottom:30px; }
    .social-links a { color:var(--light); font-size:1.5rem; transition:all .3s; }
    .social-links a:hover { color:var(--primary); transform:translateY(-3px); }
    .copyright { opacity:.8; font-size:.9rem; }

    /* === MODAL ANIMS === */
    @keyframes fadeIn { from{opacity:0}to{opacity:1} }
    @keyframes slideIn { from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1} }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-container">
      <a href="#" class="logo">S&amp;M</a>
      <button class="mobile-nav-toggle"><i class="fas fa-bars"></i></button>
      <ul class="nav-links">
        <li><a href="#home">Home</a></li>
        <li><a href="#countdown">Countdown</a></li>
        <li><a href="#story">Our Story</a></li>
        <li><a href="#gallery">Gallery</a></li>
        <li><a href="#details">Details</a></li>
        <li><a href="#rsvp">RSVP</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero" id="home">
    <div class="hero-content">
      <h2>WE ARE GETTING MARRIED</h2>
      <h1>Sarah &amp; Michael</h1>
      <p class="date">AUGUST 15, 2025</p>
      <button class="btn" onclick="location.href='#rsvp'">RSVP Now</button>
    </div>
  </section>

  <!-- COUNTDOWN -->
  <section class="countdown-section" id="countdown">
    <h2>Counting Down to Our Big Day</h2>
    <div class="countdown">
      <div class="countdown-item"><div class="countdown-num" id="days">00</div><div class="countdown-label">Days</div></div>
      <div class="countdown-item"><div class="countdown-num" id="hours">00</div><div class="countdown-label">Hours</div></div>
      <div class="countdown-item"><div class="countdown-num" id="minutes">00</div><div class="countdown-label">Minutes</div></div>
      <div class="countdown-item"><div class="countdown-num" id="seconds">00</div><div class="countdown-label">Seconds</div></div>
    </div>
  </section>

  <!-- OUR STORY -->
  <section class="story-section" id="story">
    <h2>Our Love Story</h2>
    <div class="timeline">
      <div class="timeline-item" data-key="firstMeeting">
        <div class="timeline-content">
          <div class="timeline-date">June 12, 2020</div>
          <h3>The First Meeting</h3>
          <p>We met at a mutual friend’s birthday party. Sarah spilled her drink on Michael’s shoes, and the rest is history.</p>
        </div>
      </div>
      <div class="timeline-item" data-key="firstDate">
        <div class="timeline-content">
          <div class="timeline-date">September 5, 2020</div>
          <h3>First Date</h3>
          <p>Michael took Sarah to his favorite art gallery followed by dinner at a rooftop restaurant overlooking the city.</p>
        </div>
      </div>
      <div class="timeline-item" data-key="movingIn">
        <div class="timeline-content">
          <div class="timeline-date">February 14, 2022</div>
          <h3>Moving In Together</h3>
          <p>We decided to take the next step in our relationship and found our first apartment together.</p>
        </div>
      </div>
      <div class="timeline-item" data-key="proposal">
        <div class="timeline-content">
          <div class="timeline-date">December 24, 2023</div>
          <h3>The Proposal</h3>
          <p>During a snowy evening walk through the park, Michael got down on one knee and proposed under the Christmas lights. She said yes!</p>
        </div>
      </div>
    </div>
  </section>

  <!-- TIMELINE MODAL -->
  <div class="modal" id="timeline-modal">
    <div class="modal-content timeline-modal-content">
      <span class="close-modal">&times;</span>
      <h3 id="timeline-modal-title"></h3>
      <div class="timeline-story-slider"></div>
    </div>
  </div>

  <!-- GALLERY -->
  <section class="gallery-section" id="gallery">
    <h2>Our Favorite Moments</h2>
    <div class="gallery-slider">
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
      <div class="gallery-item"><img src="/api/placeholder/600/400" alt=""></div>
    </div>
  </section>

  <!-- DETAILS -->
  <section class="details-section" id="details">
    <h2>Wedding Details</h2>
    <div class="details-grid">
      <div class="detail-card">
        <i class="fas fa-calendar-alt"></i>
        <h3>When</h3>
        <p>August 15, 2025<br>Ceremony: 2:00 PM<br>Reception: 4:00 PM</p>
      </div>
      <div class="detail-card">
        <i class="fas fa-map-marker-alt"></i>
        <h3>Where</h3>
        <p>The Grand Hall<br>123 Wedding Avenue<br>San Francisco, CA 94103</p>
      </div>
      <div class="detail-card">
        <i class="fas fa-glass-cheers"></i>
        <h3>Dress Code</h3>
        <p>Semi-Formal Attire<br>Outdoor ceremony, indoor reception</p>
      </div>
    </div>
  </section>

  <!-- RSVP -->
  <section class="rsvp-section" id="rsvp">
    <h2>RSVP</h2>
    <p>Please let us know if you can make it by July 15, 2025.</p>
    <div class="rsvp-form">
      <form id="rsvp-form">
        <div class="form-group"><label for="name">Full Name</label><input id="name" required></div>
        <div class="form-group"><label for="email">Email</label><input id="email" type="email" required></div>
        <div class="form-group">
          <label>Will you be attending?</label>
          <div class="radio-group">
            <label><input type="radio" name="attending" value="yes" required> Joyfully Accept</label>
            <label><input type="radio" name="attending" value="no"> Regretfully Decline</label>
          </div>
        </div>
        <div class="form-group" id="guests-group">
          <label for="guests">Number of Guests</label>
          <select id="guests"><option>1</option><option>2</option><option>3</option><option>4</option></select>
        </div>
        <div class="form-group"><label for="message">Message (optional)</label><textarea id="message"></textarea></div>
        <button type="submit" class="btn">Submit RSVP</button>
      </form>
    </div>
  </section>

  <!-- ADMIN DASHBOARD -->
  <div id="admin-dashboard" class="admin-dashboard" style="display:none;">
    <h2>Admin Dashboard</h2>
    <div class="stats-grid">
      <div class="stat-gauge">
        <svg viewBox="0 0 100 100">
          <circle class="gauge-bg" cx="50" cy="50" r="45"/>
          <circle class="gauge-fill" id="gauge-attending" cx="50" cy="50" r="45"/>
          <text x="50" y="55" text-anchor="middle" id="gauge-attending-text">0%</text>
        </svg>
        <h4>Attending</h4>
      </div>
      <div class="stat-gauge">
        <svg viewBox="0 0 100 100">
          <circle class="gauge-bg" cx="50" cy="50" r="45"/>
          <circle class="gauge-fill" id="gauge-not-attending" cx="50" cy="50" r="45"/>
          <text x="50" y="55" text-anchor="middle" id="gauge-not-attending-text">0%</text>
        </svg>
        <h4>Not Attending</h4>
      </div>
    </div>

    <div class="filters">
      <div class="filter-group">
        <label for="date-filter">Filter by Date:</label>
        <select id="date-filter">
          <option value="all">All Time</option>
          <option value="week">Last Week</option>
          <option value="month">Last Month</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="search-guests">Search:</label>
        <input id="search-guests" placeholder="Name or Email">
      </div>
    </div>

    <table class="guest-list-table">
      <thead>
        <tr><th>Name</th><th>Email</th><th>Status</th><th>Guests</th><th>Message</th><th>Date</th></tr>
      </thead>
      <tbody id="guest-list-body"></tbody>
    </table>
  </div>

  <!-- ADMIN LOGIN -->
  <div class="modal" id="admin-login-modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Admin Login</h3>
      <form id="admin-login-form" class="login-form">
        <div class="form-group"><label for="admin-password">Password</label><input id="admin-password" type="password" required></div>
        <button type="submit" class="btn">Login</button>
      </form>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="footer">
    <h2>Sarah &amp; Michael</h2>
    <div class="social-links">
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
    </div>
    <p>© 2025 Sarah &amp; Michael | All Rights Reserved</p>
  </footer>

  <!-- OPTIONAL CUSTOM CURSOR & HEARTS (if still desired) -->
  <div class="floating-hearts" id="floating-hearts"></div>
  <div class="custom-cursor" id="custom-cursor"></div>
  <div class="custom-cursor-dot" id="custom-cursor-dot"></div>

  <script>
  // — INIT SUPABASE —
  const supabase = supabase.createClient('YOUR_SUPABASE_URL','YOUR_SUPABASE_KEY');

  // — COUNTDOWN LOGIC —
  const weddingDate = new Date('August 15, 2025 14:00:00').getTime();
  function updateCountdown(){
    const now = Date.now(), d = weddingDate - now;
    const days = Math.floor(d/864e5),
          hrs  = Math.floor(d%864e5/36e5),
          mins = Math.floor(d%36e5/6e4),
          secs = Math.floor(d%6e4/1e3);
    document.getElementById('days').textContent    = String(days).padStart(2,'0');
    document.getElementById('hours').textContent   = String(hrs).padStart(2,'0');
    document.getElementById('minutes').textContent = String(mins).padStart(2,'0');
    document.getElementById('seconds').textContent = String(secs).padStart(2,'0');
  }
  updateCountdown(); setInterval(updateCountdown,1000);

  // — STICKY NAV & MOBILE TOGGLE —
  const navEl = document.querySelector('nav'),
        toggle= document.querySelector('.mobile-nav-toggle'),
        links = document.querySelector('.nav-links');
  window.addEventListener('scroll',()=>{ navEl.classList.toggle('scrolled', window.scrollY>100); });
  toggle.addEventListener('click',()=>{
    links.classList.toggle('active');
    toggle.innerHTML = links.classList.contains('active')?'<i class="fas fa-times"></i>':'<i class="fas fa-bars"></i>';
  });

  // — GALLERY SLIDER —
  $('.gallery-slider').slick({
    dots:true, arrows:true, infinite:true, speed:500,
    slidesToShow:3, adaptiveHeight:true,
    responsive:[
      {breakpoint:992,settings:{slidesToShow:2}},
      {breakpoint:576,settings:{slidesToShow:1}}
    ]
  });

  // — TIMELINE STORIES DATA —
  const timelineStories = {
    firstMeeting: {
      title:'The First Meeting',
      slides:[ 
        { image:'/api/placeholder/800/500', caption:'Sarah arriving at the party…' },
        { image:'/api/placeholder/800/500', caption:'The infamous drink spill…' },
        { image:'/api/placeholder/800/500', caption:'Laughing about the accident…' }
      ]
    },
    firstDate: {
      title:'First Date', slides:[
        { image:'/api/placeholder/800/500', caption:'Our first date at the art gallery…' },
        { image:'/api/placeholder/800/500', caption:'Dinner at the rooftop restaurant…' },
        { image:'/api/placeholder/800/500', caption:'Walking home under the stars…' }
      ]
    },
    movingIn: {
      title:'Moving In Together', slides:[
        { image:'/api/placeholder/800/500', caption:'Moving day! So many boxes…' },
        { image:'/api/placeholder/800/500', caption:'Takeout pizza on the floor…' },
        { image:'/api/placeholder/800/500', caption:'Making the apartment our home…' }
      ]
    },
    proposal: {
      title:'The Proposal', slides:[
        { image:'/api/placeholder/800/500', caption:'Michael planned this for months…' },
        { image:'/api/placeholder/800/500', caption:'The proposal under Christmas lights…' },
        { image:'/api/placeholder/800/500', caption:'Celebrating our engagement!' }
      ]
    }
  };

  // — TIMELINE MODAL HANDLER —
  const timelineModal       = document.getElementById('timeline-modal'),
        timelineModalTitle  = document.getElementById('timeline-modal-title'),
        storySlider         = document.querySelector('.timeline-story-slider');

  document.querySelectorAll('.timeline-item[data-key]').forEach(item=>{
    item.addEventListener('click',()=>{
      const key = item.dataset.key, story = timelineStories[key];
      if(!story) return;
      timelineModalTitle.textContent = story.title;
      storySlider.innerHTML = story.slides.map(s=>`
        <div class="timeline-slide">
          <img src="${s.image}" alt="">
          <p class="timeline-caption">${s.caption}</p>
        </div>
      `).join('');
      $(storySlider).slick({
        dots:true, arrows:true, infinite:true, speed:500,
        slidesToShow:1, adaptiveHeight:true
      });
      timelineModal.style.display = 'block';
    });
  });

  timelineModal.querySelector('.close-modal').addEventListener('click',()=>{
    timelineModal.style.display='none';
    $(storySlider).slick('unslick');
  });
  window.addEventListener('click',e=>{
    if(e.target===timelineModal){
      timelineModal.style.display='none';
      $(storySlider).slick('unslick');
    }
  });

  // — RSVP FORM SUBMIT —
  const rsvpForm=document.getElementById('rsvp-form'),
        successModal=document.getElementById('success-modal'),
        closeBtn=document.querySelector('#success-modal .close-modal')||successModal.querySelector('.btn');

  rsvpForm.addEventListener('submit',async e=>{
    e.preventDefault();
    const formData = {
      name:document.getElementById('name').value,
      email:document.getElementById('email').value,
      attending:document.querySelector('input[name="attending"]:checked').value==='yes',
      guests: (document.querySelector('input[name="attending"]:checked').value==='yes')
        ?parseInt(document.getElementById('guests').value):0,
      message:document.getElementById('message').value,
      created_at:new Date().toISOString()
    };
    try {
      let { error } = await supabase.from('rsvps').insert([formData]);
      if(error) throw error;
      successModal.style.display='block';
      rsvpForm.reset();
    } catch(err){
      alert('Error submitting RSVP. Please try again.');
      console.error(err);
    }
  });
  closeBtn.addEventListener('click',()=>successModal.style.display='none');

  // — ADMIN LOGIN & DASHBOARD —
  const adminLoginModal=document.getElementById('admin-login-modal'),
        adminLoginForm=document.getElementById('admin-login-form'),
        adminDashboard=document.getElementById('admin-dashboard');

  // hash "#admin-login" opens login
  if(window.location.hash===' #admin-login') adminLoginModal.style.display='block';

  adminLoginForm.addEventListener('submit',e=>{
    e.preventDefault();
    const pwd=document.getElementById('admin-password').value;
    if(pwd==='wedding2025'){
      adminLoginModal.style.display='none';
      adminDashboard.style.display='block';
      window.location.hash='admin';
      loadAdminData();
    } else alert('Incorrect password');
  });

  // — LOAD ADMIN DATA + GAUGES + FILTERS —
  async function loadAdminData(){
    try {
      let { data, error } = await supabase
        .from('rsvps')
        .select('*')
        .order('created_at',{ascending:false});
      if(error) throw error;

      const total = data.length;
      const attendArr = data.filter(r=>r.attending);
      const declineArr= data.filter(r=>!r.attending);
      const countA = attendArr.length, countN=declineArr.length;
      const pctA = Math.round(100*countA/total),
            pctN = Math.round(100*countN/total);

      // animate gauges
      function animateGauge(id,pct,textId){
        const circle = document.getElementById(id),
              txt    = document.getElementById(textId),
              offset = 283 - (283*pct/100);
        circle.getBoundingClientRect();
        circle.style.strokeDashoffset = offset;
        txt.textContent = pct + '%';
      }
      animateGauge('gauge-attending',pctA,'gauge-attending-text');
      animateGauge('gauge-not-attending',pctN,'gauge-not-attending-text');

      // confetti on milestone
      if(pctA>=80){
        confetti({particleCount:100, spread:70, origin:{y:0.6}});
      }

      // populate guest table
      const tbody=document.getElementById('guest-list-body');
      tbody.innerHTML = '';
      data.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${r.name}</td>
          <td>${r.email}</td>
          <td class="${r.attending?'status-attending':'status-not-attending'}">
            ${r.attending?'Attending':'Not Attending'}
          </td>
          <td>${r.guests}</td>
          <td>${r.message||'-'}</td>
          <td>${new Date(r.created_at).toLocaleDateString()}</td>
        `;
        tbody.appendChild(tr);
      });

      // filters
      document.getElementById('date-filter').onchange = filterGuests;
      document.getElementById('search-guests').oninput = filterGuests;

      function filterGuests(){
        const df = document.getElementById('date-filter').value;
        const txt = document.getElementById('search-guests').value.toLowerCase();
        const now = Date.now();
        const filtered = data.filter(r=>{
          const nameMatch = r.name.toLowerCase().includes(txt);
          const emailMatch= r.email.toLowerCase().includes(txt);
          let dateMatch=true;
          const d = new Date(r.created_at).getTime();
          if(df==='week')  dateMatch = d >= now - 7*864e5;
          if(df==='month') dateMatch = d >= now -30*864e5;
          return (nameMatch||emailMatch) && dateMatch;
        });
        tbody.innerHTML='';
        filtered.forEach(r=>{
          const tr=document.createElement('tr');
          tr.innerHTML=`
            <td>${r.name}</td><td>${r.email}</td>
            <td class="${r.attending?'status-attending':'status-not-attending'}">
              ${r.attending?'Attending':'Not Attending'}
            </td>
            <td>${r.guests}</td><td>${r.message||'-'}</td>
            <td>${new Date(r.created_at).toLocaleDateString()}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    } catch(err){
      console.error('Error loading admin data:',err);
      alert('Could not load admin data.');
    }
  }

  // handle anchor smooth scroll & hash
  document.querySelectorAll('a[href^="#"]').forEach(a=>{
    a.addEventListener('click',e=>{
      e.preventDefault();
      const tgt = document.querySelector(a.getAttribute('href'));
      if(tgt) window.scrollTo({top:tgt.offsetTop-70,behavior:'smooth'});
    });
  });
  </script>
</body>
</html>
